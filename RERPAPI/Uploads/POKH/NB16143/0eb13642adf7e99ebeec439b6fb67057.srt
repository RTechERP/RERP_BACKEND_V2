<DOCUMENT>
1
00:00:01,859 --> 00:00:03,120
Giảng viên: Giờ trong dự án của chúng ta,

2
00:00:03,120 --> 00:00:05,370
khi vào phần chi tiết ở đây,

3
00:00:05,370 --> 00:00:09,150
ta không thể thêm sản phẩm vào giỏ hàng.

4
00:00:09,150 --> 00:00:11,040
Và lý do thì rất đơn giản.

5
00:00:11,040 --> 00:00:15,480
Chúng ta chưa có mô hình (model) để lưu giỏ hàng trong cơ sở dữ liệu.

6
00:00:15,480 --> 00:00:18,480
Có nhiều cách để lưu giỏ hàng.

7
00:00:18,480 --> 00:00:21,270
Tất nhiên, bạn có thể lưu toàn bộ giỏ hàng

8
00:00:21,270 --> 00:00:23,730
trong session.

9
00:00:23,730 --> 00:00:27,000
Nhưng tôi luôn thích lưu nó trong cơ sở dữ liệu

10
00:00:27,000 --> 00:00:28,800
vì điều thường xảy ra là

11
00:00:28,800 --> 00:00:32,729
khi ai đó thêm sản phẩm vào giỏ hàng,

12
00:00:32,729 --> 00:00:35,160
nếu ta lưu trong cơ sở dữ liệu,

13
00:00:35,160 --> 00:00:37,020
ta luôn có thể theo dõi được,

14
00:00:37,020 --> 00:00:39,990
rằng sản phẩm đã nằm trong giỏ ba ngày,

15
00:00:39,990 --> 00:00:43,350
và ta có thể gửi email khuyến mãi cho họ.

16
00:00:43,350 --> 00:00:45,990
Nhờ những lợi ích tiếp thị từ giỏ hàng,

17
00:00:45,990 --> 00:00:47,670
việc lưu vào cơ sở dữ liệu

18
00:00:47,670 --> 00:00:51,033
luôn là một ý tưởng tốt.

19
00:00:51,870 --> 00:00:54,423
Vậy hãy nghĩ xem ta cần những thuộc tính nào

20
00:00:54,423 --> 00:00:58,563
để thêm một sản phẩm vào giỏ hàng?

21
00:00:59,670 --> 00:01:03,660
Để làm điều đó, ta cần biết sản phẩm nào được thêm,

22
00:01:03,660 --> 00:01:06,270
số lượng (count) của sản phẩm đó là bao nhiêu,

23
00:01:06,270 --> 00:01:07,470
và ngoài ra,

24
00:01:07,470 --> 00:01:10,020
ID của người dùng nào

25
00:01:10,020 --> 00:01:12,420
đã thêm sản phẩm vào giỏ hàng?

26
00:01:12,420 --> 00:01:15,720
Vì nếu không có user ID, sẽ rất rối

27
00:01:15,720 --> 00:01:18,363
bởi bất kỳ người dùng nào cũng có thể thêm sản phẩm.

28
00:01:19,230 --> 00:01:22,170
Nên mô hình của chúng ta khá đơn giản.

29
00:01:22,170 --> 00:01:25,410
Để tôi quay lại và dừng ứng dụng,

30
00:01:25,410 --> 00:01:27,960
đóng mọi thứ ở đây,

31
00:01:27,960 --> 00:01:30,723
và ta sẽ thêm một mô hình mới.

32
00:01:31,590 --> 00:01:36,363
Thêm một lớp mới tên là ShoppingCart.

33
00:01:37,650 --> 00:01:42,650
Nó sẽ là một lớp public với bốn thuộc tính.

34
00:01:42,990 --> 00:01:46,380
Ta sẽ có ID, là khóa chính (primary key).

35
00:01:46,380 --> 00:01:49,710
Có ProductId và UserId,

36
00:01:49,710 --> 00:01:53,010
và Count sẽ đại diện cho số lượng.

37
00:01:53,010 --> 00:01:56,250
ProductId ở đây sẽ là khóa ngoại (foreign key)

38
00:01:56,250 --> 00:01:57,780
liên kết với bảng Product.

39
00:01:57,780 --> 00:02:01,920
Nên tôi sẽ thêm khóa ngoại đó và đặt validate never,

40
00:02:01,920 --> 00:02:04,653
rồi ta có ApplicationUserId.

41
00:02:05,640 --> 00:02:09,479
Nó sẽ là khóa ngoại liên kết với bảng ApplicationUser,

42
00:02:09,479 --> 00:02:11,703
nên ta cũng sẽ thêm nó.

43
00:02:12,810 --> 00:02:15,030
Cuối cùng, ở phần Count này,

44
00:02:15,030 --> 00:02:16,620
tôi có thể thêm kiểm tra hợp lệ (validation).

45
00:02:16,620 --> 00:02:20,340
Khoảng giá trị phải từ 1 đến 1000.

46
00:02:20,340 --> 00:02:24,423
Nếu không, ta sẽ hiển thị một thông báo lỗi tùy chỉnh.

47
00:02:25,470 --> 00:02:29,220
Như vậy là ổn cho mô hình ShoppingCart.

48
00:02:29,220 --> 00:02:32,040
Ta cần thêm nó vào cơ sở dữ liệu.

49
00:02:32,040 --> 00:02:34,380
Và may mắn là với ShoppingCart,

50
00:02:34,380 --> 00:02:37,023
ta không cần phải seed bất kỳ bản ghi nào.

51
00:02:38,310 --> 00:02:40,743
Ta đã có ShoppingCart ở đây,

52
00:02:42,510 --> 00:02:45,180
đặt tên là "ShoppingCarts",

53
00:02:45,180 --> 00:02:47,343
và ta cần thêm một migration.

54
00:02:48,690 --> 00:02:52,110
Tôi sẽ gọi nó là "AddShoppingCartToDB",

55
00:02:52,110 --> 00:02:54,603
rồi để tôi cập nhật cơ sở dữ liệu.

56
00:02:59,130 --> 00:03:00,000
Hoàn hảo.

57
00:03:00,000 --> 00:03:02,610
Vậy là mô hình ShoppingCart đã được thêm

58
00:03:02,610 --> 00:03:04,110
vào cơ sở dữ liệu.

59
00:03:04,110 --> 00:03:06,783
Để tôi tiếp tục ở video sau.
</DOCUMENT>